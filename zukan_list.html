<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>図鑑一覧</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: "Yu Gothic", sans-serif;
      background: #f9f9f9; /* PC用背景 */
      color: #222;
    }

    /* ヘッダー */
    header {
      background: #3399cc;
      color: white;
      text-align: center;
      padding: 15px;
    }

    header h1 {
      margin: 0;
      font-size: 24px;
    }

    /* 一覧 */
    main {
      padding: 20px;
    }

    .list-item {
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 15px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }

    .list-item h3 {
      margin: 0 0 10px 0;
      font-size: 18px;
    }

    .list-item button {
      margin-right: 8px;
      padding: 6px 10px;
      font-size: 14px;
      border: 1px solid #666;
      border-radius: 4px;
      cursor: pointer;
      background: #f9f9f9;
    }

    .list-item button:hover {
      background: #eee;
    }

    /* マップ */
    #map {
      width: 100%;
      height: 300px;
      margin-top: 20px;
    }

    /* スマホ用レイアウト */
    @media (max-width: 600px) {
      body {
        background: #e6f2fa; /* ホーム画面と統一 */
      }
      header {
        background: none;
        color: #222;
        padding: 10px;
      }
      header h1 {
        font-size: 20px;
      }
      .list-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
      }
      .list-item {
        width: 140px;
        height: 200px;
        background: linear-gradient(to right, #3c7ca6 20px, #cce8f9 20px);
        border: 2px solid #1f5c72;
        box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 10px;
      }
      .list-item h3 {
        font-size: 16px;
        text-align: center;
        color: #000;
      }
      .list-item button {
        font-size: 13px;
        margin: 5px auto;
        display: block;
      }
      /* ナビゲーションバー */
      .navbar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #3399cc;
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
      }
      .nav-button {
        color: white;
        text-decoration: none;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>図鑑一覧</h1>
  </header>

  <main>
    <div id="zukan-list"></div>
    <div id="map"></div>
  </main>

  <!-- スマホ用ナビゲーションバー -->
  <nav class="navbar">
    <a href="index.html" class="nav-button">🏠 ホーム</a>
    <a href="zukan_list.html" class="nav-button">📚 一覧</a>
    <a href="add_name.html" class="nav-button">➕ 作成</a>
  </nav>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // ===== ローカル保存操作 =====
    function getZukans() {
      return JSON.parse(localStorage.getItem("zukans") || "[]");
    }
    function saveZukans(zukans) {
      localStorage.setItem("zukans", JSON.stringify(zukans));
    }
    function deleteZukan(id) {
      const zukans = getZukans().filter(z => z.id !== id);
      saveZukans(zukans);
      renderList();
    }

    // ===== 一覧描画 =====
    function renderList() {
      const container = document.getElementById("zukan-list");
      container.innerHTML = "";

      const zukans = getZukans();
      zukans.forEach(zukan => {
        const item = document.createElement("div");
        item.className = "list-item";

        item.innerHTML = `
          <h3>${zukan.name}</h3>
          <button onclick="viewZukan(${zukan.id})">🔍 閲覧</button>
          <button onclick="if(confirm('${zukan.name} を削除しますか？')) deleteZukan(${zukan.id})">🗑 削除</button>
          <button onclick="addPhoto(${zukan.id})">📷 写真追加</button>
        `;

        container.appendChild(item);
      });
    }

    function viewZukan(id) {
      localStorage.setItem("currentZukanId", id);
      window.location.href = "zukan_view.html";
    }

    function addPhoto(id) {
      localStorage.setItem("currentZukanId", id);
      window.location.href = "add_photo.html";
    }

    // ===== マップ描画 =====
    function renderMap() {
      const map = L.map("map").setView([38.2688, 140.8719], 13); // 仙台

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors"
      }).addTo(map);

      const zukans = getZukans();
      zukans.forEach(zukan => {
        if (zukan.photos) {
          zukan.photos.forEach(photo => {
            if (photo.lat && photo.lng) {
              const marker = L.marker([photo.lat, photo.lng]).addTo(map);
              marker.bindPopup(
                `<b>${photo.name}</b><br>
                 <img src="${photo.image}" width="100"><br>
                 ${photo.description || ''}`
              );
            }
          });
        }
      });
    }

    // 初期化
    renderList();
    renderMap();
  </script>
</body>
</html>
